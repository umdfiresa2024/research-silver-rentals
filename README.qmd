---
title: "Silver Rentals"
format: gfm
editor: visual
---

## How did the expansion of the Silver Line of the Washington Metro System impact residential rental prices?

## Introduction:

The opening of the Silver Line of the Washington Metro System was a major transportation expansion that aimed to improve accessibility and connectivity between Washington, D.C., and the surrounding regions, particularly in Northern Virginia. Transportation improvements such as these can have significant effects on local housing markets, including rental prices, as they increase convenience and reduce commuting times for residents. Proximity to public transit is a desirable factor for many renters, often leading to rental price increases in areas adjacent to new transit lines (Peng et al., 2023).

This research seeks to analyze the rental price effects following the expansion of the Silver Line in 2022, specifically focusing on how rents have changed for each zip code in Arlington,  Fairfax,  Loudoun counties. Analyzing rental price trends along the Silver Line will reveal how transit-oriented development (TOD) impacts housing affordability. This study will provide valuable insights for urban planners and policymakers on managing housing costs to ensure affordability in these neighborhoods. This analysis will provide valuable insights into how new infrastructure projects can influence housing affordability in rapidly growing metropolitan areas, contributing to urban planning and housing policy discussions.

## Literature Review:

There is a variety of literature about the impact that different types of transit have on either rent prices or house prices. Peng et. al (2024) used difference-in-difference modeling to find the change in rental prices after the announcement of the Purple Line light rail construction in Maryland. The two or more bedroom units saw rent increases, however, there is no effect on the one bedroom units due to the increasing supply and high turnover (Peng et. al., 2024). Peng and Knaap (2023) also showed that home values increase when houses are closer to the planned Purple Line construction. At the same time, the home values will not increase when there is an existing metro station near the future light rail station (Peng and Knaap, 2023). Although these studies are noteworthy, the existing literature is not aligned with our area of interest. Our study will only focus on how the opening of the Silver Line extension in Northern Virginia will impact rental prices. 

Step 1. Install necessary packages.

```{r}
# install.packages("tidyverse")
# install.packages("kableExtra")

```

Step 2. Declare that you will use these packages in this session.

```{r}
library("terra")
library("tidyverse")
library("kableExtra")

```

Step 3. Upload the dataframe that you have created in Spring 2024 into the repository.

Step 4. Open the dataframe into the RStudio Environment.

```{r}
df<-read.csv("panel.csv")

df2<-df %>%
  mutate(date = as.Date(Date, format = "%Y.%m.%d"), month = month(date), year = year(date))
```

Step 5. Use the **head** and **kable** function showcase the first 10 rows of the dataframe to the reader.

```{r}
kable(head(df2))
```

## Question 1: What is the frequency of this data frame?

Answer: Monthly

## Question 2: What is the cross-sectional (geographical) unit of this data frame?

Answer: Zip code

Step 6. Use the **names** function to display all the variables (column) in the dataframe.

```{r}
names(df2)

```

## Question 3: Which column represents the treatment variable of interest?

Answer: open2022 and post

Treatment Group: Rental prices after the silver line expansion opening(Nov 2022) within 1.5 miles of the silver line expansion

Control Group: Rental prices in Fairfax and Loudoun county that either are farther than 1.5 miles from the silver line expansion, or were listed before the silver line expansion opening

## Question 4: Which column represents the outcome variable of interest?

Answer: ZORI

Step 7: Create a boxplot to visualize the distribution of the outcome variable under treatment and no treatment.

```{r}

df3 <- filter(df2, year=="2022")
ggplot(df3, aes(x=ZORI)) +
  geom_histogram() +
  facet_wrap(~open2022)
```

Step 8: Fit a regression model $y=\beta_0 + \beta_1 x + \epsilon$ where $y$ is the outcome variable and $x$ is the treatment variable. Use the **summary** function to display the results.

```{r}

model1<-lm(ZORI ~ open2022*post, data=df2)

summary(model1)
```

## Question 5: What is the predicted value of the outcome variable when treatment=0?

Answer: 2075.458

## Question 6: What is predicted value of the outcome variable when treatment=1?

Answer: 2075.458 + 426.789 = 2503.247

## Question 7: What is the equation that describes the linear regression above? Please include an explanation of the variables and subscripts.

Answer: $$ZORI_{i, t} = \beta_0 + \beta_1 open2022_i\times post_t + \epsilon_{i,t}$$\
Where i is zip code and t is month

$open2022$ represents zip codes that are within 1.5 miles of stations that open in 2022.

$post$ represents opening status of the Silver Line expansion after November 2022 and after.

$open2022 \times post$ represents zip codes that are within 1.5 miles of stations in 2022 after its opening date.

Question 8: What fixed effects can be included in the regression? What does each fixed effects control for? Please include a new equation that incorporates the fixed effects.

Answer: $$ZORI_{i,t} = \beta_1 open2022_i \times post_t + \beta_2 open2014 + \beta_3 openother + \zeta_{month} + \theta{year}  + \lambda_{city} + \epsilon_{i,t}$$

Where $z$ represents the zip code and $m$ represents the current month

Answer: $$ZORI = \beta_0 + \beta_1 open2022:post+ \beta_2 city + \beta_3 zip\_code + \beta_4 month + \beta_5 year + \epsilon$$

## Question 9: What is the impact of the treatment effect once fixed effects are included?

```{r}
model2 <- lm(ZORI ~ open2022 + post + open2022:post + open2014 + openother + as.factor(month) + as.factor(year) + as.factor(City) + as.factor(CountyName), data=df)

df5 <- df %>% mutate(time=(round(interval(as.Date("2022-11-30"), date)/months(1)))) %>%
    mutate (post_12m_before = (time >= -12 & time < -6)) %>% 
    mutate (post_6m_before = (time >= -6 & time < 0)) %>% 
    mutate(post_6m_after = (time <= 6 & time > 0)) %>% 
    mutate(post_12m_after = (time <= 12 & time > 6))

model3 <- lm(ZORI ~ dist + post + dist:post + open2014 + openother + as.factor(month) + as.factor(year) + as.factor(City) + as.factor(CountyName), data=df5)

model4 <- lm(ZORI ~ open2022*post + open2022*post_12m_before + open2022*post_6m_before + open2022*post_6m_after  + open2022*post_12m_after + open2014 + openother + as.factor(month) + as.factor(year) + as.factor(City) + as.factor(CountyName), data=df5)
model5 <- lm(ZORI ~ dist*post + dist*post_12m_before + dist*post_6m_before + dist*post_6m_after  + dist*post_12m_after + open2014 + openother + as.factor(month) + as.factor(year) + as.factor(City) + as.factor(CountyName), data=df5)
#summary(model2)
summary(model5)
```

model2 \<- lm(ZORI \~ silver + as.factor(City) + as.factor(ZIPCODE) + as.factor(month) + as.factor(year), data=df2) summary(model2) \`\`\`

## 

Answer: When fixed effects are included, the silver line's effect jumps from 188 to 630.

```{r}
df6 <- df %>%
  group_by(date, open2022) %>%
  summarise(avgPrice = mean(ZORI)) %>%
  mutate(date = as.Date(date)) %>%
  mutate(open2022 = ifelse(open2022==1, "Yes", "No"))

opening_date <- as.Date("2022-11-30")

ggplot(df6, aes(x = date, y = avgPrice, color=factor(open2022))) +
  geom_line() + 
  geom_vline(xintercept = as.numeric(opening_date), linetype = "dashed", color = "black") + 
  annotate("text", x = opening_date, y = max(df6$avgPrice), label = "Expansion Open Date", vjust = -0.5, color = "Black") +
  scale_x_date(date_labels = "%Y-%m-%d", date_breaks = "2 years") +
  labs(title = "ZORI Rental prices over time",
       x = "Date", 
       y = "Average Price",
       color = "Station near 2022 expansion?")
```

```{r}
# Map of the treated and untreated group

metro<-vect("Metro_Stations_Regional/Metro_Stations_Regional.shp")
line<-vect("Metro_Lines_Regional/Metro_Lines_Regional.shp")

metrodf<-as.data.frame(metro)

treated<-c("Ashburn", "Loudoun Gateway", "Dulles International Airport", 
       "Innovation Center", "Herndon", "Reston Town Center")
untreated<-c("Vienna/Fairfax-GMU", "Dunn Loring-Merrifield", "West Falls Church",
       "East Falls Church", "Ballston MU", "Virginia Square-GMU", "Clarendon",
       "Court House", "Rosslyn", "Arlington Cemetery", "Pentagon", "Pentagon City",
       "Crystal City", "Ronald Reagan Washington National Airport", "Potomac Yard",
       "Braddock Road", "King St-Old Town", "Eisenhower Ave", "Huntington",
       "Van Dorn Street", "Franconia-Springfield")

silver_2022 <- buffer(subset(metro, metro$NAME %in% treated), width=2414)
other_stations <- buffer(subset(metro, metro$NAME %in% untreated), width=2414)

# Project zip codes in the treated stations buffer
va2 <- vect("VA/VA_Zip_Codes.shp")
va_project2 <- project(va2, crs(metro))
va_project2 <- terra::makeValid(va_project2)
va_2022 <- terra::intersect(va_project2, silver_2022)
va_2022_df <- as.data.frame(va_2022) |>
  select(ZIP_CODE) |>
  rename(ZIPCODE = ZIP_CODE) |>
  mutate(open = 2022)

# Project zip codes in the untreated stations buffer
va3 <- vect("VA/VA_Zip_Codes.shp")
va_project3 <- project(va3, crs(metro))
va_project3 <- terra::makeValid(va_project3)
other_zips <- terra::intersect(va_project3, other_stations)
other_zips_df <- as.data.frame(other_zips) |>
  select(ZIP_CODE) |>
  rename(ZIPCODE = ZIP_CODE) |>
  mutate(open = "other_stations")

# Create the overlay
plot(line)
plot(silver_2022, col="red", add=TRUE)
plot(va_2022, col="red", add=TRUE)
plot(other_zips, col="gold", add=TRUE)

legend("topright", legend=c("Treated", "Untreated"), fill=c("red", "gold"), border="black", xpd = TRUE)
```

# Questions for Week 5

library("fixest")

model2 \<- feols(ZORI \~ open2022 + post + open2022:post + open2014 + openother \| month + year + City, data=df2)

model3 \<- feols(ZORI \~ open2022 + post + open2022:post \| Date + ZIPCODE, data=df2)

model4 \<- feols(ZORI \~ open2022 + post + open2022:post + open2014 + openother \| Date + City, data=df2)

summary(model2) summary(model3) summary(model4) \`\`\`

Possible explanations why rents do not change:

-   High turnover of renters

-   Higher supply

-   More people buy houses rather than rent

-   Cost of rent is already high because of other businesses near the metro station

Step 9: Change the document format to gfm

Step 10: Save this document as README.qmd

Step 11: Render the document. README.md file should be created after this process.

Step 12: Push the document back to GitHub and observe your beautiful document in your repository!

Step 13: If your team has a complete dataframe that includes both the treated and outcome variable, you are done with the assignment. If not, make a research plan in Notion to collect data on the outcome and treatment variable and combine it into one dataframe.

## Future Plans:

The house rental prices may not have adjusted immediately as the expansion of the silver line opened. As such, including the time since the expansion opened may help us better understand the silver line's effects on rental prices.

## References:

Peng, Q., & Knaap, G. (2023). When and Where Do Home Values Increase in Response to Planned Light Rail Construction?. *Journal of Planning Education and Research*, 0739456X221133022.

Peng, Q., Knaap, G. J., & Finio, N. (2024). Do Multifamily unit Rents Increase in Response to Light Rail in the Pre-service Period?. *International Regional Science Review*, 47(5-6), 566-590.
